# Lomtev-faithful config for fingerflex decoding experiments
# Matches FingerFlex (Lomtev, 2023) preprocessing choices applied to Miller data.
# Key differences from fingerflex_default.yaml:
#   - pipeline_mode: lomtev (zscore+CAR before filter, MinMax targets)
#   - bandpass: 40-300 Hz (Lomtev's range)
#   - loss: mse_cosine (0.5*MSE + 0.5*(1-cos))
#   - lr: 8.42e-5 (Lomtev's exact value)
#   - batch_size: 128 (Lomtev's value)

seed: 42

data:
  task: fingerflex
  patient: bp            # One of: bp, cc, ht, jc, jp, mv, wc, wm, zt
  data_dir: data/fingerflex
  sr: 1000               # Sampling rate (Hz)
  n_targets: 5           # 5 fingers

preprocessing:
  pipeline_mode: lomtev  # 'ours' or 'lomtev'
  apply_car: true
  notch_freqs: [60, 120, 180]
  bandpass_lo: 40.0      # Lomtev: 40 Hz (vs our 1 Hz)
  bandpass_hi: 300.0     # Lomtev: 300 Hz (vs our 200 Hz)
  normalize: true

preprocessing_lomtev:
  bandpass_lo: 40.0
  bandpass_hi: 300.0
  notch_freqs: [60, 120, 180]   # 60 Hz + harmonics (US data)
  n_wavelets: 40
  downsample_fs: 100
  time_delay_sec: 0.2
  n_jobs: 1

windowing:
  window_size: 1000      # Samples (= 1 second at 1000 Hz)
  hop_size: 100          # Samples (= 100 ms hop -> 10 Hz output rate)

windowing_lomtev:
  sample_len: 256               # 256 @ 100 Hz = 2.56s
  stride: 1

split:
  train_frac: 0.70
  val_frac: 0.15
  test_frac: 0.15

model:
  name: unet_lomtev
  n_channels_out: 5
  channels: [32, 32, 64, 64, 128, 128]
  kernel_sizes: [7, 7, 5, 5, 5]
  strides: [2, 2, 2, 2, 2]
  dilation: [1, 1, 1, 1, 1]

training:
  batch_size: 128        # Lomtev: 128 (vs our 32)
  epochs: 20             # Lomtev: 20 (vs our 100 with early stopping)
  optimizer: adam
  lr: 8.42e-5            # Lomtev's exact LR (vs our 1e-3)
  weight_decay: 1.0e-6   # Lomtev: 1e-6 (vs our 0)
  scheduler: reduce_on_plateau
  scheduler_patience: 5
  scheduler_factor: 0.5
  early_stopping_patience: 15
  grad_clip_max_norm: 1.0
  loss: mse_cosine       # Lomtev: 0.5*MSE + 0.5*(1-cos) (vs our mse)

evaluation:
  metric: pearson_r      # Primary metric
  smooth_sigma_val: 6    # Gaussian σ for validation — matches FingerFlex
  smooth_sigma_test: 1   # Gaussian σ for test — matches FingerFlex

logging:
  use_wandb: true
  wandb_project: plact-motor-decoding
  tags: [miller, lomtev, unet]
